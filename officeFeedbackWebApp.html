<!DOCTYPE html>
<html>
  <head>
    <title>CDW Office Feedback</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="https://webobjects2.cdw.com/is/image/CDW/cdw23-logo-no-tag-88x48"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@momentum-ui/core@19.15.22/css/momentum-ui.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
      html,
      body {
        overflow-x: hidden; /* Hide horizontal scrollbar */
        overflow-y: scroll; /* Add vertical scrollbar */
      }

      .star {
        /*         display: block;
        text-align: center;
        margin: auto; */
        width: 128px;
        height: 128px;
      }

      .flip-card {
        width: 128px;
        height: 128px;
        /*         perspective: 1000px; */
      }

      .flip-card-inner {
        width: 100%;
        height: 100%;
        transition: transform 0.6s;
        transform-style: preserve-3d;
      }

      .animate {
        transform: rotateY(180deg);
      }

      .flip-card-front,
      .flip-card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
      }

      .flip-card-back {
        transform: rotateY(180deg);
      }
    </style>
  </head>

  <body>
    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="circle-arrow-left" viewbox="0 -10 100 110">
          <path
            d="m 20 80 A 40 40 0 1 0 20 20"
            fill="none"
            stroke="#000"
            stroke-width="10"
          />
          <path d="M 10 0 v 40 h 40" fill="#000" />
        </symbol>
      </defs>
      <!-- to make the circle-arrow-left.svg file
       also usable as image: -->
      <use href="#circle-arrow-left" />
    </svg>

    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="blankStar">
          <path
            stroke="#000"
            stroke-width="4"
            d="m4.66664,50.4119l45.04549,0l13.9194,-45.0786l13.91941,45.0786l45.04549,0l-36.4425,27.85979l13.92012,45.0786l-36.44252,-27.86055l-36.44251,27.86055l13.92013,-45.0786l-36.44251,-27.85979z"
            fill="#cccccc"
          />
          <path
            d="m1016.31546,44.62155l6.11154,0l1.88851,-2.2918l1.88851,2.2918l6.11154,0l-4.94433,1.41639l1.88861,2.2918l-4.94433,-1.41643l-4.94433,1.41643l1.88861,-2.2918l-4.94433,-1.41639z"
            stroke="#000"
            fill="#fff"
          />
        </symbol>
        <symbol id="fullStar">
          <path
            stroke="#000"
            stroke-width="4"
            d="m4.66664,50.4119l45.04549,0l13.9194,-45.0786l13.91941,45.0786l45.04549,0l-36.4425,27.85979l13.92012,45.0786l-36.44252,-27.86055l-36.44251,27.86055l13.92013,-45.0786l-36.44251,-27.85979z"
            fill="#ffff00"
          />
          <path
            d="m1016.31546,44.62155l6.11154,0l1.88851,-2.2918l1.88851,2.2918l6.11154,0l-4.94433,1.41639l1.88861,2.2918l-4.94433,-1.41643l-4.94433,1.41643l1.88861,-2.2918l-4.94433,-1.41639z"
            stroke="#000"
            fill="#fff"
          />
        </symbol>
      </defs>
    </svg>

    <section class="hero is-fullheight">
      <div class="hero-head"></div>
      <div class="hero-body">
        <div class="container">
          <div class="columns has-text-centered is-multiline">
            <div class="column is-12">
              <figure class="image">
              <svg xmlns="http://www.w3.org/2000/svg" height="5em" viewbox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M243.4 2.6l-224 96c-14 6-21.8 21-18.7 35.8S16.8 160 32 160v8c0 13.3 10.7 24 24 24H456c13.3 0 24-10.7 24-24v-8c15.2 0 28.3-10.7 31.3-25.6s-4.8-29.9-18.7-35.8l-224-96c-8-3.4-17.2-3.4-25.2 0zM128 224H64V420.3c-.6 .3-1.2 .7-1.8 1.1l-48 32c-11.7 7.8-17 22.4-12.9 35.9S17.9 512 32 512H480c14.1 0 26.5-9.2 30.6-22.7s-1.1-28.1-12.9-35.9l-48-32c-.6-.4-1.2-.7-1.8-1.1V224H384V416H344V224H280V416H232V224H168V416H128V224zM256 64a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
              </figure>
              <p class="title pt-6 has-text-dark">
                How was your overall office experience today?
              </p>
            </div>
          </div>
          <div class="columns is-mobile mt-5 mb-6">
            <div
              class="column is-flex is-justify-content-center"
              onclick="captureRating(1)"
            >
              <div class="flip-card">
                <div class="flip-card-inner">
                  <div class="flip-card-front">
                    <svg class="star" version="2.0">
                      <use href="#blankStar" />
                    </svg>
                  </div>
                  <div class="flip-card-back">
                    <svg class="star" version="2.0">
                      <use href="#fullStar" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="column is-flex is-justify-content-center"
              onclick="captureRating(2)"
            >
              <div class="flip-card">
                <div class="flip-card-inner">
                  <div class="flip-card-front">
                    <svg class="star" version="2.0">
                      <use href="#blankStar" />
                    </svg>
                  </div>
                  <div class="flip-card-back">
                    <svg class="star" version="2.0">
                      <use href="#fullStar" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="column is-flex is-justify-content-center"
              onclick="captureRating(3)"
            >
              <div class="flip-card">
                <div class="flip-card-inner">
                  <div class="flip-card-front">
                    <svg class="star" version="2.0">
                      <use href="#blankStar" />
                    </svg>
                  </div>
                  <div class="flip-card-back">
                    <svg class="star" version="2.0">
                      <use href="#fullStar" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="column is-flex is-justify-content-center"
              onclick="captureRating(4)"
            >
              <div class="flip-card">
                <div class="flip-card-inner">
                  <div class="flip-card-front">
                    <svg class="star" version="2.0">
                      <use href="#blankStar" />
                    </svg>
                  </div>
                  <div class="flip-card-back">
                    <svg class="star" version="2.0">
                      <use href="#fullStar" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="column is-flex is-justify-content-center"
              onclick="captureRating(5)"
            >
              <div class="flip-card">
                <div class="flip-card-inner">
                  <div class="flip-card-front">
                    <svg class="star" version="2.0">
                      <use href="#blankStar" />
                    </svg>
                  </div>
                  <div class="flip-card-back">
                    <svg class="star" version="2.0">
                      <use href="#fullStar" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="columns has-text-centered">
            <div class="column">
              <p class="title pt-7 has-text-dark">Share your feedback üëç</p>
            </div>
          </div>
        </div>
      </div>

      <div class="hero-foot"></div>
    </section>

    <div id="notification-modal" class="modal">
      <div class="modal-background"></div>

      <div class="modal-content">
        <div class="box">
          <div id="confirmation">
            <p class="title pt-7 has-text-dark has-text-centered">Thank you</p>
            <p class="title pt-7 has-text-dark has-text-centered">
              Your feedback has been captured üëç
            </p>
          </div>
          <div id="support">
            <p class="title pt-7 has-text-dark has-text-centered">
              Sorry for the low rating üòî
            </p>

            <div class="pt-3 pb-5 is-flex is-justify-content-center" id="qrcode"></div>
            <p class="title mt-7 has-text-dark has-text-centered">
              Scan this QR code to share more details.
            </p>
          </div>
        </div>
      </div>

      <button class="modal-close is-large" aria-label="close"></button>
    </div>

    <script>
      
      let url = '';
      let building = "testing";
      let area = "testing";
      let supportURL = "https://www.example.com/";

      const confirmationCloseDelay = 4; // Close the confirmation modal in 1 sec
      const supportCloseDelay = 60; // Close the support modal in 30 sec

      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);

      if (urlParams.get("building")) {
        building = urlParams.get("building");
      }

      if (urlParams.get("location")) {
        area = urlParams.get("location");
      }

      if (urlParams.get("target")) {
        url = urlParams.get("target");
      }
      
      if (urlParams.get("support")) {
        supportURL = urlParams.get("support");
      }

      console.log("Building: ", building);
      console.log("Location: ", area);
      console.log("Target Url: ", url);
      console.log("Support Url: ", supportURL);

      new QRCode(document.getElementById("qrcode"), supportURL);
      const stars = document.getElementsByClassName("flip-card-inner");
      const modal = document.getElementById("notification-modal");
      const confirmation = document.getElementById("confirmation");
      const support = document.getElementById("support");

      let submitting = false;
      let modalAutoClose;

      function captureRating(rating) {
        if (submitting) return;
        submitting = true;
        let autoclose = confirmationCloseDelay;

        console.log("Rating Pressed:", rating);

        if (rating <= 3) {
          console.log("Low Rating - Showing Support");
          confirmation.style.display = "none";
          support.style.display = "block";
          autoclose = supportCloseDelay;
        } else {
          console.log("High Rating - Showing Confirmation");
          confirmation.style.display = "block";
          support.style.display = "none";
        }

        console.log("Rating Pressed:", rating);
        for (let i = 0; i < rating; i++) {
          setTimeout(() => {
            stars[i].classList.add("animate");
          }, 100 * (i + 1));
        }

        const data = {
          building: building,
          location: area,
          rating: rating,
        };

        postData(url, data);
        setTimeout(openModal, 1200, modal, autoclose);
      }

      // Example POST method implementation:
      function postData(url = "", data = {}) {
        console.log("Sending Data", data);
        // Default options are marked with *
        fetch(url, {
          method: "POST", // *GET, POST, PUT, DELETE, etc.
          //mode: "no-cors", // no-cors, *cors, same-origin
          cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
          //credentials: "same-origin", // include, *same-origin, omit
          headers: {
            "Content-Type": "application/json",
            // 'Content-Type': 'application/x-www-form-urlencoded',
          },
          redirect: "follow", // manual, *follow, error
          referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
          body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
      }

      function openModal($el, autoclose = 2) {
        $el.classList.add("is-active");
        console.log(
          `Opening modal - will auto close in [${autoclose}] seconds`
        );
        modalAutoClose = setTimeout(closeModal, autoclose * 1000, modal);
      }

      function closeModal($el) {
        for (let i = 0; i < stars.length; i++) {
          stars[i].classList.remove("animate");
        }
        clearTimeout(modalAutoClose);
        submitting = false;
        $el.classList.remove("is-active");
      }

      (
        document.querySelectorAll(
          ".modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button"
        ) || []
      ).forEach(($close) => {
                const $target = $close.closest(".modal");
                $close.addEventListener("click", () => {
                  closeModal($target);
                });
      });
    </script>
  </body>
</html>
